-- =====================================================================
-- WinStore - ADR-010: Разделение проекта на MS SQL и Oracle ветви
-- =====================================================================
-- Description: Фиксирует архитектурное решение о разделении репозитория на
--              две поддерживаемые ветви БД: MS SQL (sql/) и Oracle (oracle/),
--              а также стандарты и процессы для Oracle-части после недавних исправлений.
-- Author:      WinStore Development Team
-- Created:     2025-10-01
-- Modified:    2025-10-01
-- Version:     1.0.0
-- =====================================================================
-- Dependencies: docs/ORCL_SQL_style_guide.md, docs/ADR-009_* (стандарты документации)
-- =====================================================================

# ADR-010: Разделение проекта на MS SQL и Oracle ветви

## Статус
Принято (2025-10-01)

## Контекст
Проект WinStore исторически содержал скрипты под MS SQL и их миграцию на Oracle в одном дереве. Для снижения связности, оптимизации CI/CD и избегания ошибок кросс-портирования принято разделить артефакты по СУБД на отдельные каталоги с независимыми жизненными циклами.

## Решение
- Закрепить две параллельные ветви БД в одном репозитории:
  - `sql/` — исходная MS SQL версия (поддерживается отдельно, без влияния Oracle-изменений).
  - `oracle/` — целевая Oracle версия (основной фокус дальнейших доработок).
- Все архитектурные решения, относящиеся к Oracle, фиксировать ADR файлами в каталоге `oracle/` рядом с README.
- Принять и соблюдать стандарты документирования из ADR-009 и SQL Style Guide в части Oracle.

## Детали реализации
- Oracle-скрипты приведены к единым паттернам:
  - NCLOB в представлениях используется через `DBMS_LOB.SUBSTR(...)` и не включается в `GROUP BY`.
  - Материализованные представления: `REFRESH COMPLETE ON DEMAND`.
  - Пакеты согласованы со схемой: авто-ID через триггеры `TRG_*_BI` и последовательности `SEQ_*`.
  - Пользователи и права: корректные пароли и валидные GRANT роли/объектные права.
  - Развертывание журналируется: `SPOOL` в `oracle/logs/oracle_deploy_YYYYMMDD_HH24MISSlog.lst`.
  - Аудит: единая конфигурация Unified Auditing с идемпотентной настройкой.

## Альтернативы
- Оставить все в одной ветви: повышает риск регрессий между СУБД, усложняет поддержку.
- Вынести Oracle в отдельный репозиторий: усложняет трассировку общей истории и кросс-ссылок.

## Последствия
- Процессы релизов и ревью разделяются по каталогам `sql/` и `oracle/`.
- CI/CD пайплайны могут быть настроены независимо для MS SQL и Oracle.
- Документация и ADR для Oracle хранятся локально в `oracle/`.

## Ссылки
- `oracle/README.md`
- `docs/ORCL_SQL_style_guide.md`
- ADR-009: Стандарты документирования базы данных и SQL кода
