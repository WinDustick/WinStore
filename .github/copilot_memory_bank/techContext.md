# Технический контекст базы данных WinStore

## Технологический стек

1. **База данных**: Проект поддерживает две СУБД:
   - **Microsoft SQL Server (MS SQL):** Исходная реализация. Скрипты в каталоге `/sql`.
   - **Oracle Database:** Добавлена для гибкости и опыта. Скрипты в каталоге `/oracle`.
   - Выбор активной СУБД осуществляется на уровне конфигурации приложения.

2. **Backend**:
   - Python 3.10+
   - Django 4.2+
   - Django REST Framework для API
   - Взаимодействие с СУБД через соответствующие драйверы: `django-mssql-backend` (MS SQL) и `oracledb` (Oracle).

3. **Content Management System**:
   - Directus для управления контентом и административного интерфейса.
   - Может подключаться к любой из поддерживаемых баз данных.

4. **Frontend**:
   - HTML, CSS, JavaScript для простых страниц
   - Возможное добавление React или Vue.js в будущем

5. **Инфраструктура**:
   - Docker и Docker Compose для контейнеризации
   - Nginx как веб-сервер и обратный прокси

## Структура базы данных

База данных WinStore следует следующим принципам:

1. **Нормализация**: База данных нормализована до 3NF (третьей нормальной формы) с некоторыми исключениями для оптимизации производительности.

2. **Ссылочная целостность**: Используются внешние ключи для обеспечения ссылочной целостности между таблицами.

3. **Разделение ответственности**:
   - База данных отвечает за хранение и базовую целостность данных
   - Сложная бизнес-логика вынесена в прикладной уровень
   - Триггеры используются только для автоматического обновления полей, как updated_at
   - Хранимые процедуры используются как тонкие обертки для доступа к данным

4. **Использование справочников**: Для часто используемых значений (статусы, типы) созданы справочные таблицы с внешними ключами.

5. **Гибкость атрибутов товаров**: Используется подход EAV (Entity-Attribute-Value) для хранения разнородных атрибутов товаров различных категорий.

## Примечания по производительности

1. **Индексы**: 
   - Созданы индексы для часто используемых полей в WHERE и JOIN условиях
   - Используются как простые, так и составные индексы для оптимизации работы с данными

2. **Типы данных**:
   - Используются наиболее подходящие типы данных для каждого поля
   - Для строковых полей с переменной длиной используется NVARCHAR
   - Для фиксированной длины (например, коды валют) используется NCHAR

3. **Представления (Views)**:
   - Созданы представления для часто используемых сложных запросов
   - Используется PIVOT для преобразования EAV структуры в удобный для запросов формат

4. **Избегание срабатывания триггеров**:
   - Бизнес-логика вынесена из триггеров для улучшения производительности и контролируемости

## Интеграция с прикладным уровнем

1. **Django Models**:
   - Модели Django отражают структуру базы данных
   - Используется inspectdb для начального генерирования моделей
   - Ручная доработка моделей для обеспечения полного соответствия бизнес-требованиям

2. **Бизнес-логика**:
   - Реализована в сервисных классах Django
   - Используются транзакции для обеспечения атомарности операций
   - Валидация данных выполняется до сохранения в базу

3. **API**:
   - RESTful API реализовано с помощью Django REST Framework
   - Используются ViewSets и Serializers для стандартизации API

4. **Directus**:
   - Настроен для работы с представлениями, созданными в базе данных
   - Предоставляет административный интерфейс для работы с каталогом товаров и заказами
