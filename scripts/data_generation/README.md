# WinStore - Стратегия генерации данных

## 1. Цель

Основная цель — наполнить базу данных Oracle большим (десятки тысяч записей) набором реалистичных и логически целостных данных. Это необходимо для проведения нагрузочного тестирования, проверки производительности сложных аналитических запросов и общей демонстрации работы системы.

## 2. Ключевые принципы

Процесс генерации следует философии проекта "Absurdly Ideal Code":

- **Реализм:** Данные должны максимально точно отражать реальный мир комплектующих для ПК. Не допускаются нелогичные комбинации (например, "Core i3 с 16 ядрами").
- **Модульность:** Каждый логический этап (создание базовых сущностей, генерация продуктов по категориям, создание заказов) вынесен в отдельный скрипт. Это упрощает поддержку, отладку и повторный запуск отдельных частей генерации.
- **Надежность и транзакционность:** Все операции по вставке данных выполняются в рамках транзакций. В случае ошибки при обработке пакета данных, вся транзакция откатывается (`rollback`), что гарантирует целостность базы данных.
- **Производительность:** Все операции вставки в БД выполняются пакетами (batch) по 50-100 записей с использованием `oracledb.executemany()` для минимизации задержек.
- **Конфигурируемость:** Ключевые параметры (количество записей, данные для подключения к БД) вынесены в переменные или читаются из окружения.

## 3. Гибридный подход к генерации

Для достижения максимального реализма используется два подхода:

1.  **Data-Driven (На основе данных):** Для компонентов со строгими и сложными взаимосвязями характеристик (CPU, GPU). Скрипт работает с предопределенным набором данных (в виде списка словарей), который имитирует спарсенную информацию с сайта производителя. Это гарантирует, что каждая модель имеет корректные спецификации.
2.  **Rule-Based (На основе правил):** Для компонентов с большим количеством допустимых комбинаций (RAM, PSU, накопители). Скрипт содержит набор правил, по которым генерируются валидные сочетания характеристик (например, для DDR5 не могут быть сгенерированы тайминги от DDR4).

## 4. Структура и порядок выполнения скриптов

Скрипты должны выполняться в строгом порядке для соблюдения зависимостей (Foreign Key constraints).

### Шаг 0: Установка зависимостей

Перед запуском необходимо добавить `Faker` в `backend/requirements.txt` и установить зависимости:
```bash
pip install -r backend/requirements.txt
```

### Шаг 1: `00_utils.py`

- **Назначение:** Вспомогательный модуль, не запускается напрямую.
- **Функционал:** Содержит общие утилиты: `get_db_connection()` для подключения к Oracle и `batch_insert()` для выполнения пакетных вставок.

### Шаг 2: `01_populate_base_entities.py`

- **Назначение:** Заполнение базовых справочников, от которых зависят все остальные данные.
- **Порядок действий:**
    1.  **Categories:** Заполняет таблицу `Categories` предопределенным списком категорий (`CPU`, `GPU`, `Motherboard` и т.д.).
    2.  **Vendors:** Читает все файлы `*.txt` и `*.csv` со списками производителей, формирует единый уникальный список и заполняет таблицу `Vendors`.
    3.  **Attributes:** Заполняет таблицу `Attributes` полным списком возможных характеристик для всех категорий товаров.
    4.  **Users:** Генерирует ~100-200 пользователей с помощью `Faker`.
- **Результат:** Создает в директории `scripts/data_generation/generated_ids/` JSON-файлы для использования на следующих этапах:
    - `users.json`: массив числовых ID пользователей, например `[1,2,3,...]`.
    - `vendors.json`: массив объектов вида `{ "id": <number>, "name": <string> }`.
    - `categories.json`: массив объектов вида `{ "id": <number>, "name": <string> }`.
    - `attributes.json`: массив объектов вида `{ "id": <number>, "name": <string> }`.

### Шаг 3: Специализированные генераторы продуктов

Находятся в директории `scripts/data_generation/products/`. Запускаются после `01_populate_base_entities.py`.

- **`products/generate_cpu.py`:**
    - **Подход:** парсинг
    - **Логика:** чтение URL, парсинг данных с сайта, пропуск невышедших процессоров, создание пакетной транзакционной записи в базу данных.
    - **Требования:** перед запуском создать файл `scripts/data_generation/cpu_urls.txt` (или скорректировать `URL_FILE` в скрипте) со списком URL по одному в строке.

- **`products/generate_ram.py`:**
    - **Подход:** Rule-Based.
    - **Логика:** На основе правил генерирует валидные комбинации модулей RAM (DDR4/DDR5) от производителей из `ram_manufacturers.txt`.

- **`products/generate_gpu_nvidia.py`:**
    - **Подход:** Rule-Based + URL-seed (опционально).
    - **Цель:** Сгенерировать максимально реалистичные данные по линейкам NVIDIA без живого парсинга.
    - **Покрытие:** GTX 9x0/10x0/16x0 и RTX 20x0/30x0/40x0/50x0, с Ti/Super вариациями и партнерами (MSI, ASUS, Gigabyte, EVGA, Zotac, Palit, PNY и др.).
    - **Классы (1-7):** Каждый «класс» влияет на цену, объем памяти, ширину шины, TDP и габариты. Цена берется из базовой таблицы и колеблется в диапазоне ±15%.
    - **Атрибуты NVIDIA:** Используются только нвидиевские признаки (CUDA/NVENC/NVDEC; для RTX — RT/Tensor Cores). Исключаются AMD-специфичные поля.
    - **URL-seed:** Если файл `scripts/data_generation/gpu_links/gpu_nvidia.txt` существует, модели берутся из него (только названия); сетевые запросы не выполняются. Иначе используется встроенная решетка моделей.
    - **Дедупликация:** Повторные товары не вставляются (проверка по `(product_NAME, ven_ID)`).
    - **Запуск (fish):**
      ```fish
      # активируйте виртуальную среду при необходимости
      python scripts/data_generation/products/generate_gpu_nvidia.py
      ```
    - **Требования:** В таблице Vendors должны присутствовать партнеры NVIDIA (MSI, Asus, Gigabyte Technology, EVGA, Zotac, Palit, PNY, Gainward, KFA2, Colorful, Inno3D, NVIDIA). Скрипт автоматически выберет доступных по именам из `vendors.json`.

- **`products/generate_gpu_nvidia_gt.py`:**
        - **Подход:** Rule-Based + URL-seed (только GT-модели).
        - **Цель:** Сгенерировать реалистичные бюджетные NVIDIA GT (610/710/720/730/740/1010/1030) для офис/HTPC сегмента.
        - **Поведение URL-seed:** Фильтрует только `geforce-gt-*` из `gpu_links/gpu_nvidia.txt`, нормализует номера (610/710/730/740/1010/1030) и генерирует по ним варианты. Если файла нет — использует встроенный набор моделей.
        - **Особенности:** Низкое энергопотребление, узкая шина, DDR3/DDR4/GDDR5 по модели, чаще низкопрофильные/пассивные варианты, как правило без разъема питания (кроме некоторых 740).
        - **Запуск (fish):**
            ```fish
            python scripts/data_generation/products/generate_gpu_nvidia_gt.py
            ```

- **Другие скрипты (`generate_motherboard.py`, `generate_psu.py`...):**
    - Создаются по аналогии, используя наиболее подходящий подход для каждой категории.

### Шаг 4: `02_populate_orders.py`

- **Назначение:** Имитация пользовательской активности.
- **Порядок действий:**
    1.  Загружает ID пользователей и продуктов из `.json` файлов.
    2.  Для каждого пользователя создает случайное количество заказов (`Orders`).
    3.  Каждый заказ наполняет случайными товарами (`OrderItems`).
    4.  Для заказов создает платежи (`Payments`).
    5.  Для некоторых купленных товаров генерирует отзывы (`Review`).
    6.  Для некоторых пользователей наполняет списки желаемого (`Wishlist`).

Этот план обеспечивает создание комплексного и правдоподобного набора данных для всестороннего тестирования платформы WinStore.
