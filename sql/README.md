# WinStore SQL Scripts Documentation

## Обзор

Этот каталог содержит все SQL-скрипты для базы данных платформы электронной коммерции WinStore. Скрипты организованы по функциональному назначению и порядку зависимостей для упрощения разработки, развертывания и сопровождения.

## Структура каталогов

- **`deploy.sql`** - Мастер-скрипт развертывания, который выполняет все SQL-скрипты в правильном порядке
- **`01_schema/`** - Определение схемы базы данных
  - `01_core_schema.sql` - Создание базы данных, таблиц, ограничений целостности
  - `02_reference_data.sql` - Справочные таблицы и начальные данные
  - `03_status_transitions.sql` - Таблицы переходов между статусами и их начальные данные
  - `04_indexes.sql` - Все индексы базы данных
- **`02_audit/`** - Настройка системы аудита
  - `audit_setup.sql` - Конфигурация BusinessAuditLog и системы аудита
- **`03_views/`** - Представления базы данных
  - `product_views.sql` - Представления для данных о товарах (видеокарты, процессоры, RAM)
  - `system_views.sql` - Представления для статусов и системных данных
- **`04_procedures/`** - Хранимые процедуры
  - `product_procedures.sql` - Процедуры для работы с товарами
  - `order_procedures.sql` - Процедуры для работы с заказами
  - `payment_procedures.sql` - Процедуры для работы с платежами
  - `user_procedures.sql` - Процедуры для работы с учетными записями пользователей
- **`05_triggers/`** - Триггеры базы данных
  - `triggers.sql` - Все триггеры базы данных

## Инструкции по развертыванию

### Полное развертывание

Для развертывания всей базы данных с нуля:

```sql
-- Выполнение мастер-скрипта развертывания
SQLCMD -S [имя_сервера] -d master -i deploy.sql -o log_deployment.txt
```

### Частичное развертывание

Для разработки или обновления определенных компонентов:

1. Выполните только необходимые файлы скриптов в порядке зависимостей
2. Всегда начинайте с файлов схемы при изменении структур
3. Запускайте с помощью SQLCMD или выполняйте непосредственно в SQL Server Management Studio

## Соглашения об именовании

- **Таблицы**: Существительные во множественном числе в PascalCase (например, `Products`, `OrderItems`)
- **Представления**: Префикс `view_` или `vw_` с описательным именем (например, `view_gpu_details`)
- **Хранимые процедуры**: Префикс `sp_` с глаголом и существительным (например, `sp_GetProductDetails`)
- **Триггеры**: Префикс `TR_` с именем таблицы и действием (например, `TR_Products_UpdateTimestamp`)
- **Индексы**: Префикс `IX_` с именем таблицы и столбцов (например, `IX_Products_CategoryID`)

## Руководство по разработке

1. **Заголовки скриптов**: Все скрипты должны включать стандартный шаблон заголовка с описанием, автором, датой и зависимостями
2. **Обработка ошибок**: Все процедуры должны включать правильную обработку ошибок с блоками TRY-CATCH
3. **Транзакции**: Используйте транзакции для многооператорных операций, чтобы обеспечить целостность данных
4. **Комментарии**: Добавляйте комментарии для сложной логики или бизнес-правил
5. **Проверки существования объектов**: Всегда проверяйте существование объектов перед их созданием/изменением

## Философия

База данных следует философии "Absurdly Ideal Code" со следующими принципами:
- **Простота**: Акцент на четких, понятных структурах
- **Целостность данных**: Обеспечение связей через ограничения и внешние ключи
- **Разделение ответственности**: Бизнес-логика находится в приложении, база данных отвечает за хранение и базовую целостность данных

## Зависимости скриптов

Скрипты должны выполняться в пронумерованном порядке внутри каждой папки. Зависимости между папками следуют следующему порядку:
1. Schema (01_schema/)
2. Audit (02_audit/)
3. Views (03_views/)
4. Procedures (04_procedures/)
5. Triggers (05_triggers/)

## Дополнительная документация

Подробное руководство по стилю SQL для проекта находится в файле `.github/copilot_memory_bank/SQL_style_guide.md`. Пожалуйста, следуйте этим стандартам при создании или модификации SQL-кода.

## История изменений

- **Май 2025**: Полная реорганизация файловой структуры SQL-скриптов, внедрение единых стандартов форматирования и документирования
- **Май 2025**: Добавление мастер-скрипта deploy.sql для последовательного выполнения
- **Май 2025**: Оптимизация производительности базы данных, добавление покрывающих индексов и индексированных представлений
