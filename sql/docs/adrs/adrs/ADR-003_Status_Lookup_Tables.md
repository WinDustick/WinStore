# ADR-003: Использование справочных таблиц для управления статусами сущностей

## Статус

Принято (2025-05-09)

## Контекст

Статусы заказов, платежей и доставки ранее могли храниться как строковые значения с ограничениями `CHECK` в соответствующих таблицах.

## Рассмотренные варианты

1. **Хранить статусы как строки с `CHECK` ограничениями:** Просто для небольшого, фиксированного набора статусов.

2. **Создать отдельные таблицы-справочники для статусов:** (например, `OrderStatusTypes`, `PaymentStatusTypes`, `DeliveryStatusTypes`) и использовать внешние ключи (`*_status_ID`) в основных таблицах.

## Принятое решение

Выбран Вариант 2. Созданы таблицы `OrderStatusTypes`, `PaymentStatusTypes`, `DeliveryStatusTypes`. В таблицах `Orders` и `Payments` строковые поля статусов заменены на `INT` поля (`order_STATUS_ID`, `payment_STATUS_ID`, `delivery_STATUS_ID` в `Orders`), ссылающиеся на эти справочники.

## Обоснование

* **Целостность данных:** Внешние ключи гарантируют, что используются только допустимые значения статусов.
* **Нормализация:** Устраняется дублирование строковых значений.
* **Гибкость и Управляемость:** Добавление, изменение или удаление (логическое) статусов осуществляется через CRUD-операции над справочниками без изменения схемы основных таблиц или `CHECK` ограничений.
* **Расширяемость:** Упрощает добавление дополнительных атрибутов к статусам (например, описание, цвет для UI, порядок сортировки).
* **Локализация:** Справочники легко расширяются для хранения отображаемых имен статусов на разных языках.
* **Производительность:** Операции с `INT` (ID статуса) обычно эффективнее, чем со строками.

## Последствия

* Требуются дополнительные `JOIN` операции в запросах для получения текстового представления статуса (например, `status_NAME_RU`). Это приемлемая плата за указанные преимущества.
* Необходимо выполнить миграцию существующих данных для заполнения новых полей `*_status_ID`.
* Прикладной код должен быть обновлен для работы с ID статусов и, при необходимости, для получения их текстовых представлений из справочников.
