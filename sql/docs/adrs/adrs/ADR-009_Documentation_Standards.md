# ADR-009: Стандарты документирования базы данных и SQL кода

## Статус

Принято (2025-05-30)

## Контекст

По мере развития базы данных WinStore стало очевидно, что необходимо стандартизировать подход к документированию как самой структуры базы данных, так и SQL кода. Хорошая документация критически важна для:

1. **Понимания структуры и бизнес-логики** новыми членами команды
2. **Поддержки согласованности** между компонентами системы
3. **Упрощения обслуживания и расширения** кодовой базы
4. **Обеспечения соответствия** архитектурным решениям и принципам проекта
5. **Содействия эффективной коммуникации** между разработчиками базы данных и приложения

Текущая документация имела пробелы, стилистические различия и нуждалась в более структурированном подходе.

## Рассмотренные варианты

### Вариант 1: Минимальная документация в коде
**Преимущества:**
- Низкие первоначальные затраты времени на документирование
- Фокус на реальном коде, а не документации

**Недостатки:**
- Сложность понимания для новых участников
- Высокие риски отклонения от принципов "Absurdly Ideal Code"
- Трудности при передаче знаний и обучении

### Вариант 2: Автоматическая генерация документации
**Преимущества:**
- Автоматизированный процесс
- Гарантированная актуальность документации

**Недостатки:**
- Ограниченная выразительность автоматической документации
- Отсутствие контекстной информации и обоснования решений
- Необходимость дополнительных инструментов и интеграций

### Вариант 3: Комплексный подход к документации с четкими стандартами
**Преимущества:**
- Полное и всестороннее документирование всех аспектов базы данных
- Согласованный стиль и структура
- Документирование не только "что" и "как", но и "почему"
- Баланс между встроенной документацией и внешними документами

**Недостатки:**
- Требует значительных начальных усилий
- Необходимость поддерживать документацию в актуальном состоянии

## Принятое решение

Выбран Вариант 3. Внедрить комплексный подход к документации базы данных и SQL кода со следующими компонентами:

1. **Центральный репозиторий документации в формате Markdown:**
   - `/database_documentation.md` - Основной документ, описывающий структуру и бизнес-логику
   - `/system_statuses.md` - Документация по системе статусов и переходов
   - `/SQL_style_guide.md` - Руководство по стилю SQL кода

2. **Стандартизированные заголовки для всех SQL файлов:**
   ```sql
   -- =====================================================================
   -- WinStore - [Название компонента]
   -- =====================================================================
   -- Description: [Краткое описание содержимого файла]
   -- Author:      WinStore Development Team
   -- Created:     [Дата создания в формате YYYY-MM-DD]
   -- Modified:    [Дата последнего изменения в формате YYYY-MM-DD]
   -- Version:     [Версия в формате X.Y.Z]
   -- =====================================================================
   -- Dependencies: [Список файлов, от которых зависит данный файл]
   -- =====================================================================
   ```

3. **Стандарты документирования в коде:**
   - **Таблицы:** Комментарий перед созданием каждой таблицы, объясняющий её назначение
   - **Столбцы:** Комментарии для неочевидных столбцов или тех, что имеют особое значение
   - **Представления:** Подробный комментарий о назначении и логике представления
   - **Хранимые процедуры:** Заголовок с описанием, параметрами и возвращаемыми значениями
   - **Триггеры:** Описание условий срабатывания и выполняемых действий
   - **Разделы кода:** Разделение кода на логические блоки с заголовками

4. **Архитектурные решения (ADR):**
   - Каждое значимое архитектурное решение должно быть документировано в виде ADR
   - Поддержание индекса ADR в актуальном состоянии

5. **Визуализация структуры:**
   - Включение ER-диаграмм для ключевых компонентов
   - Диаграммы переходов состояний для статусных сущностей

## Обоснование

* **Соответствие "Absurdly Ideal Code":** Качественная документация является неотъемлемой частью идеального кода, обеспечивая его понятность и поддерживаемость.
* **Удобство для новых членов команды:** Структурированная документация значительно сокращает время адаптации новых разработчиков.
* **Поддержание качества:** Четкие стандарты документации способствуют поддержанию высокого качества кода.
* **Эффективная коммуникация:** Документация служит средством коммуникации между различными участниками проекта.
* **Снижение рисков:** Документированный код снижает риски при обслуживании и модификации.

## Последствия

1. **Все существующие SQL файлы** должны быть обновлены в соответствии с новыми стандартами документации.
2. **Центральные документы документации** должны быть созданы или обновлены для отражения текущего состояния базы данных.
3. **Инструменты разработки** могут быть настроены для поддержки шаблонов документации.
4. **Процесс код-ревью** должен включать проверку соответствия стандартам документации.
5. **Введение новых сотрудников** должно включать ознакомление с документацией базы данных.

Принятие этих стандартов документации является важным шагом к обеспечению долгосрочной устойчивости и поддерживаемости проекта WinStore, что соответствует философии "Absurdly Ideal Code".
