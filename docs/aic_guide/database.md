# Философия Базы Данных

Подход к проектированию базы данных в WinStore является краеугольным камнем всей архитектуры и строго следует философии "Абсурдно Идеального Кода". Основной принцип — **четкое разделение ответственности**: база данных отвечает за хранение, целостность и быстрый доступ к данным, в то время как вся сложная бизнес-логика вынесена на уровень приложения.

## Основные принципы

*   **Бизнес-логика в приложении:** Мы не используем триггеры или сложные хранимые процедуры для реализации бизнес-правил. Такие операции, как расчет скидок, обновление складских остатков или управление статусами, выполняются в коде бэкенда. Это решение задокументировано в [ADR-001](/.github/copilot_memory_bank/adrs/ADR-001_Business_Logic_To_App_Layer.md) и является центральным для нашей архитектуры.

*   **Декларативная целостность:** Целостность данных обеспечивается с помощью декларативных механизмов СУБД: первичные и внешние ключи, ограничения `CHECK` и `UNIQUE`. Это делает схему данных самодокументируемой и надежной.

*   **Нормализация и простота:** Схема данных спроектирована так, чтобы быть максимально простой и нормализованной, избегая избыточности. Примером такого подхода является упрощенная модель доставки, описанная в [ADR-002](/.github/copilot_memory_bank/adrs/ADR-002_Simplified_Delivery_Model.md).

*   **Гибкость через EAV:** Для хранения многочисленных и разнообразных характеристик товаров используется модель Entity-Attribute-Value (EAV), которая обеспечивает гибкость без усложнения основной схемы продуктов.

## Структура и организация

Все SQL-скрипты для создания и управления базой данных находятся в директориях `sql/` (для MS SQL) и `oracle/` (для Oracle). Структура этих директорий идентична и организована по функциональному назначению:

*   `01_schema/`: Определение основной схемы (таблицы, ключи).
*   `02_audit/`: Настройка аудита.
*   `03_views/`: Представления для удобного доступа к данным.
*   `04_procedures/`: Простые хранимые процедуры (в основном для атомарных операций).
*   `05_triggers/`: Минимальное количество триггеров (например, для обновления временных меток).

## Ключевые документы и ресурсы

*   **[Документация по базе данных](../../.github/copilot_memory_bank/database_documentation.md):** Подробное описание схемы, таблиц и связей.
*   **[Руководство по стилю SQL](../../.github/copilot_memory_bank/SQL_style_guide.md):** Стандарты написания SQL-кода, которым необходимо следовать.
*   **[SQL README (MS SQL)](../../sql/README.md):** Обзор и инструкции по развертыванию для MS SQL.
*   **[Oracle README](../../oracle/docs/README.md):** Обзор и инструкции по развертыванию для Oracle, а также описание ключевых отличий.
