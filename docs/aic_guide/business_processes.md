# Управление Бизнес-процессами

Одной из ключевых особенностей архитектуры WinStore является подход к управлению бизнес-процессами, основанный на статусах. Вместо того чтобы кодировать логику переходов между состояниями в коде приложения, мы используем декларативный подход, храня правила непосредственно в базе данных.

## Статусная модель

В системе определены три основных типа статусов, каждый из которых имеет свой собственный справочник и таблицу переходов:

*   **Статусы заказа (`OrderStatusTypes`):** Отражают жизненный цикл заказа от создания до завершения (например, "В корзине", "В обработке", "Доставлен").
*   **Статусы платежа (`PaymentStatusTypes`):** Отражают состояние платежа (например, "Ожидает", "Выполнен", "Не удался").
*   **Статусы доставки (`DeliveryStatusTypes`):** Описывают процесс доставки (например, "Готовится к отправке", "В пути", "Доставлен").

Использование справочников для статусов, как описано в [ADR-003](/.github/copilot_memory_bank/adrs/ADR-003_Status_Lookup_Tables.md), обеспечивает целостность данных и гибкость.

## Декларативные переходы статусов

Для каждого типа статусов существует таблица переходов (например, `OrderStatusTransitions`), которая определяет, из какого статуса в какой можно перейти. Это решение, задокументированное в [ADR-006](/.github/copilot_memory_bank/adrs/ADR-006_Status_Transition_Tables.md), дает нам несколько преимуществ:

*   **Прозрачность:** Бизнес-процесс становится самодокументируемым. Чтобы понять жизненный цикл заказа, достаточно посмотреть на таблицу `OrderStatusTransitions`.
*   **Гибкость:** Для изменения бизнес-процесса (например, добавления нового шага) достаточно изменить данные в таблице переходов, не трогая код приложения.
*   **Надежность:** Приложение использует эти таблицы как единый источник истины для валидации всех изменений статусов, что исключает возможность некорректных переходов.
*   **Динамический UI:** Фронтенд может запрашивать доступные переходы для текущего статуса и динамически отображать возможные действия пользователю.

## Реализация

На уровне приложения существуют сервисы, которые инкапсулируют логику работы со статусами. Перед изменением статуса сервис обращается к базе данных, чтобы проверить, является ли переход допустимым. Если да, статус изменяется; если нет, возвращается ошибка.

## Ключевые документы и ресурсы

*   **[Системные статусы](../../.github/copilot_memory_bank/system_statuses.md):** Подробное описание системы статусов и правил переходов.
*   **[ADR-003: Использование справочных таблиц для статусов](/.github/copilot_memory_bank/adrs/ADR-003_Status_Lookup_Tables.md):** Обоснование решения использовать справочники для статусов.
*   **[ADR-006: Декларативное определение переходов статусов](/.github/copilot_memory_bank/adrs/ADR-006_Status_Transition_Tables.md):** Обоснование решения использовать таблицы переходов.
